{% extends "base_talk.html" %}
{% block title %}THY TALK{% endblock %}


{# MAIN CONTENT #}
{% block content %}

{% if session["user_id"] %}
<h6>You are logged in as {{User.query.get(session["user_id"]).name}} {{User.query.get(session["user_id"]).last_name}}
</h6>
{%endif%}
{#{% for user in users %}#}
{% for post in all_posts|reverse %}
<div class="container-fluid " id="post_container{{post.id}}">
    {# POSTS DIVISION #}
    <div class="row">
        <div class="col-lg-fluid">

            <div class="media-body">

                <div class="well well-lg w-100 h-100 shadow-sm p-2 bg-white rounded"
                    id="post{{post.id}}">

                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-xs-2">
                                {% if User.query.get(post.user_id).img_url %}
                                <a href="/talk/{{ User.query.get(post.user_id).id }}"><img
                                        src="{{User.query.get(post.user_id).img_url}}" class="img-fluid"
                                        width="50px"></a>
                                {% endif %}
                            </div>
                            <div class="col-xs-10">
                                <h5><span class="glyphicon glyphicon-time"></span> Posted by {{post.post_author}} -
                                    {{post.pub_date}}</h5>

                                {{post.post}}
                            </div>
                        </div>

                        {# LIKES TO POSTS DIVISION#}
                        <div class="row">
                            <div class="col-12 d-flex justify-content-end">

                                <button id="likepost{{loop.index}}" data-post-id="{{post.id}}" name="likepost"
                                    class="btn btn-info btn-xs glyphicon glyphicon-thumbs-up likepost"
                                    data-toggle="tooltip" data-placement="top" title="" style="margin-left:5px"> {#empty
                                    tooltip 'title'
                                    attr = tooltip doesn't show#}
                                    {{post.likes|length}}
                                </button>

                                <button id="dislikepost{{loop.index}}" data-post-id="{{post.id}}" name="dislikepost"
                                    class="btn btn-info btn-xs dislikepost glyphicon glyphicon-thumbs-down"
                                    style="margin-left:5px">
                                    {{post.dislikes|length}}
                                </button>

                                {%if session["user_id"] == post.user_id%}
                                <button id="deletepost{{loop.index}}" data-post-id="{{post.id}}" name="deletepost"
                                    class="btn btn-info btn-xs deletepost glyphicon glyphicon-trash"
                                    style="margin-left:5px">
                                </button>
                                {%endif%}

                                <!-- <button id="flagpost{{loop.index}}" data-post-id="{{post.id}}" name="flagpost"
                                        class="btn btn-info btn-xs flagpost glyphicon glyphicon-flag">
                                    </button> -->

                                <form action="/api/reply/{{post.id}}" method="POST"
                                    style="position:relative; display:inline-block">
                                    <button id="replypost{{loop.index}}" data-post-id="{{post.id}}" name="replypost"
                                        class="btn btn-info btn-xs replypost bi bi-reply" style="margin-left:5px">
                                    </button>

                                </form>
                            </div>
                        </div>
                    </div>

                </div>

            </div>
        </div>
    </div>


    {# REPLYS DIVISION #}

    {% for response in post.responses%}
    <div class="row d-flex justify-content-end mb-4 p-0" id="response{{response.id}}">
        <div class="col-10">
            
            <div class="well well-lg w-100 h-100 shadow-sm p-2 bg-white rounded">
                <div class="container-fluid">
                    <div class="row">
                        <h5><span class="glyphicon glyphicon-time"></span>{{response.reply_author}} -
                            {{response.response_date}}</h5>
                        <div class="col-xs-12">
                            {{response.response}}
                        </div>
                    </div>
                    {# LIKES TO REPLIES DIVISION #}
                    <div class="row">
                        <div class="col-5 ml-auto" style="top:-15%;">

                            {##}
                            <button type="submit" id="likereply{{loop.index}}" name="likereply"
                                data-response-id="{{response.id}}"
                                class="btn btn-info btn-xs glyphicon glyphicon-thumbs-up likereply"
                                style="background-color:rgb(26, 33, 166)"> {{response.likes_reply|length}} </button>

                            <button type="submit" id="dislikereply{{loop.index}}" name="dislikereply"
                                data-response-id="{{response.id}}"
                                class="btn btn-info btn-xs glyphicon glyphicon-thumbs-down dislikereply"
                                style="background-color:rgb(26, 33, 166)"> {{response.dislikes_reply|length}} </button>
                            {%if session["user_id"] == post.user_id%}

                            <button type="submit" id="deletereply{{loop.index}}" name="deletereply"
                                data-response-id="{{response.id}}"
                                class="btn btn-info btn-xs glyphicon glyphicon-trash deletereply"
                                style="background-color:rgb(26, 33, 166)">
                            </button>
                            {%endif%}

                            <!-- <button type="submit" id="flagreply{{loop.index}}" name="flagreply" data-response-id="{{response.id}}"
                    class="btn btn-info btn-xs glyphicon glyphicon-flag flagreply"
                    style="background-color:rgb(26, 33, 166)">
                </button> -->

                        </div>
                    </div>
                </div>

            </div>
        </div>


    </div>
    {%endfor%}

    <!-- post_id_form = {{post_id_form}}
    <p></p>
    post.id = {{post.id}} -->


</div>
<br>
<br>
{%endfor%}
{#{%endfor%}#}

{%endblock%}
{# END OF MAIN CONTENT #}

{# SIDE CONTENT RIGHT #}
{#{% block sidecontent_r %}{%endblock%}#}
{# END OF SIDE CONTENT #}



{#



#}